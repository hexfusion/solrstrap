.\" Automatically generated by Pod::Man 2.28 (Pod::Simple 3.29)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{
.    if \nF \{
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\" ========================================================================
.\"
.IX Title "Vend::Payment::NetBilling 3"
.TH Vend::Payment::NetBilling 3 "2016-12-23" "perl v5.22.2" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "Interchange NetBilling Support"
.IX Header "Interchange NetBilling Support"
Vend::Payment::NetBilling \f(CW$Revision:\fR 1.6 $
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 1
\&    &charge=netbilling
\& 
\&        or
\& 
\&    [charge route=netbilling param1=value1 param2=value2]
.Ve
.SH "PREREQUISITES"
.IX Header "PREREQUISITES"
.Vb 3
\&  LWP::UserAgent
\&  LWP::Protocol::https
\&  Digest::MD5
.Ve
.PP
All of these need be present and working.
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
The Vend::Payment::NetBilling module implements the \fInetbilling()\fR routine
for use with Interchange. It is compatible on a call level with the other
Interchange payment modules.  In theory (and even usually in practice) you
could switch from another payment module to NetBilling with a few
configuration file changes.
.SH "SETUP"
.IX Header "SETUP"
To enable this module, place this directive in your \f(CW\*(C`interchange.cfg\*(C'\fR
file:
.PP
.Vb 1
\&    Require module Vend::Payment::NetBilling
.Ve
.PP
This \fImust\fR be in interchange.cfg or a file included from it.
.PP
Make sure CreditCardAuto is off which is the default in the \fIStandard\fR
ecommerce demo.
.PP
The mode can be named anything, but the \f(CW\*(C`gateway\*(C'\fR parameter must be set
to \f(CW\*(C`netbilling\*(C'\fR. To make it the default payment gateway for all credit
card transactions in a specific catalog, you can set in \f(CW\*(C`catalog.cfg\*(C'\fR:
.PP
.Vb 1
\&    Variable   MV_PAYMENT_MODE  netbilling
.Ve
.SH "SETTINGS"
.IX Header "SETTINGS"
Vend::Payment::NetBilling uses several of the standard settings from Interchange payment.
Any time we speak of a setting, it is obtained either first from the tag/call
options, then from an Interchange order Route named for the mode, then finally
a default global payment variable, For example, the \f(CW\*(C`id\*(C'\fR parameter would be
specified by:
.PP
.Vb 1
\&    [charge route=netbilling id=YourNetBillingID]
.Ve
.PP
or
.PP
.Vb 1
\&    Route netbilling id YourNetBillingID
.Ve
.PP
or
.PP
.Vb 1
\&    Variable MV_PAYMENT_ID      YourNetBillingID
.Ve
.SS "The settings are:"
.IX Subsection "The settings are:"
.IP "amount" 4
.IX Item "amount"
Amount for the transaction.  Defaults to the checkout total after all
shipping, taxes discounts, and other levies have been applied.
.IP "getid" 4
.IX Item "getid"
The path to the getid script on the NetBilling secure server.  Defaults to
\&\*(L"/gw/native/getid1.0\*(R".
.IP "host" 4
.IX Item "host"
The domain name of the NetBilling secure server.  Defaults to
\&\*(L"secure.netbilling.com\*(R".
.IP "id" 4
.IX Item "id"
This is your account and sitetag separated by a colon (\s-1ACCOUNT:SITETAG\s0).
\&\s-1ACCOUNT\s0 is the number of your Netbilling merchant or agent account, as a
12\-character string. Required for \s-1ALL\s0 transactions. \s-1SITETAG\s0 is the site
tag of your website configured in the Netbilling system. Required for
membership transactions, optional for others.
Global parameter is \s-1MV_PAYMENT_ID.\s0
.IP "poll" 4
.IX Item "poll"
The path to the poll script on the NetBilling secure server.  Defaults to
\&\*(L"/gw/native/poll1.0\*(R".
.IP "port" 4
.IX Item "port"
The port to connect to on the NetBilling secure server.  Defaults to the
standard https port (443).
.IP "remap" 4
.IX Item "remap"
This remaps the form variable names to the ones needed by NetBilling.
.IP "remote_host" 4
.IX Item "remote_host"
Hostname of customer for NetBilling to record for this transaction.
Defaults to the session remote host.
.IP "remote_ip" 4
.IX Item "remote_ip"
\&\s-1IP\s0 address of customer for NetBilling to record for this transaction.
Defaults to the session \s-1IP.\s0
.IP "retries" 4
.IX Item "retries"
Number of times to attempt a connection to the NetBilling secure server before
giving up.  Defaults to 3.
.IP "script" 4
.IX Item "script"
The path to the NetBilling direct mode 2.1 script on the NetBilling secure
server.  Defaults to \*(L"/gw/native/direct2.1\*(R".
.IP "secret" 4
.IX Item "secret"
Your NetBilling Order Integrity Key, set in the NetBilling admin interface in
step 11 of 'Fraud Defense'.
Global parameter is \s-1MV_PAYMENT_SECRET.\s0
.IP "trans_id" 4
.IX Item "trans_id"
Netbilling Transaction \s-1ID\s0 returned from a previous transaction. Used for '\s-1REFUND\s0'
type transactions, the amount of the refund/Void and other relevant data will be
taken from the original transaction data.
.IP "transaction" 4
.IX Item "transaction"
The type of transaction to be run. Valid values are:
.Sp
.Vb 10
\&  Interchange  NetBilling
\&  \-\-\-\-\-\-\-\-\-\-\-  \-\-\-\-\-\-\-\-\-\-
\&  avs          AVS         Address verification only, no charges
\&  auth         AUTH        Pre\-Auth a charge card for later capture
\&  return       CREDIT      Credit the charge/ACH account instead of charging it
\&  reverse      REFUND      Will attempt a VOID or a Refund of a previous \*(AqSALE\*(Aq
\&  sale         SALE        Standard charge/ACH transaction
\&  settle       CAPTURE     Capture a Pre\-Authed charge
\&  void         REFUND      Will attempt a VOID or a Refund of a previous \*(AqSALE\*(Aq
\&  abort        ABORT       Will abort a pending capture
.Ve
.Sp
The \*(L"reverse\*(R" and \*(L"void\*(R" transactions are both sent as a \*(L"\s-1REFUND\*(R"\s0 because
NetBilling determines internally whether to \*(L"\s-1VOID\*(R"\s0 or \*(L"\s-1REFUND\*(R"\s0 based on if
the original transaction has been batched out yet.  The default is \*(L"sale\*(R".
.IP "type" 4
.IX Item "type"
The payment type.  Set to \*(L"K\*(R" or any string with the word \*(L"check\*(R" in it
for online checking.  Any other value for charge.  If left unset or blank
will default to the \*(L"mv_order_profile\*(R" form value or \s-1CGI\s0 variable which can
be \*(L"remap\*(R"ped to a different actual form name (see \f(CW\*(C`remap\*(C'\fR).  If
everything is blank this defaults to charge.
.SH "VALUES"
.IX Header "VALUES"
Values can be obtained either from processed or raw \s-1CGI\s0 values.  The \s-1CGI\s0
names can be \*(L"remap\*(R"ped with the \f(CW\*(C`remap\*(C'\fR setting above in case your form
names are different.
.IP "address1" 4
.IX Item "address1"
Customer's shipping street address and also the default for b_address1.
.IP "auth_code" 4
.IX Item "auth_code"
Force code provided by credit card processor. Optional.
.IP "b_address1" 4
.IX Item "b_address1"
Customer's billing street address.  Required for address verification. Defaults to
address1.
.IP "b_city" 4
.IX Item "b_city"
Customer's billing city.  Required for address verification.  Defaults to city.
.IP "b_country" 4
.IX Item "b_country"
Customer's billing country.  Required for address verification.  Defaults to
country.
.IP "b_fname" 4
.IX Item "b_fname"
Customer's billing first name.  Required for address verification.  Defaults to fname.
.IP "b_lname" 4
.IX Item "b_lname"
Customer's billing last name.  Required for address verification.  Defaults to lname.
.IP "b_state" 4
.IX Item "b_state"
Customer's billing state/province.  Required for address verification.  Defaults
to state.
.IP "b_zip" 4
.IX Item "b_zip"
Customer's billing zip/postal code.  Required for address verification.  Defaults
to zip.
.IP "check_account" 4
.IX Item "check_account"
Checking account number. Required for \s-1ACH\s0 transactions.
.IP "check_dl" 4
.IX Item "check_dl"
Optional driver's license number field, but necessary for proper online check
fraud screening. In any case, only \s-1ONE\s0 of \s-1SSN, DL\s0 or \s-1TAXID\s0 will be used if
provided, in that order of preference.
.IP "check_dl_state" 4
.IX Item "check_dl_state"
The two-character postal code for the state the \s-1ID\s0 was issued in. Leave blank
if inappropriate, for instance, when using \s-1SSN.\s0
.IP "check_number" 4
.IX Item "check_number"
An optional check sequence number, provided by the customer.
.IP "check_routing" 4
.IX Item "check_routing"
Checking account routing code. Required for \s-1ACH\s0 transactions.
.IP "check_ssn" 4
.IX Item "check_ssn"
Optional social security number field, but necessary for proper online check
fraud screening. In any case, only \s-1ONE\s0 of \s-1SSN, DL\s0 or \s-1TAXID\s0 will be used if
provided, in that order of preference.
.IP "check_taxid" 4
.IX Item "check_taxid"
Optional tax id number field, but necessary for proper online check
fraud screening. In any case, only \s-1ONE\s0 of \s-1SSN, DL\s0 or \s-1TAXID\s0 will be used if
provided, in that order of preference.
.IP "city" 4
.IX Item "city"
Customer's shipping city and also the default for b_city.
.IP "comment1" 4
.IX Item "comment1"
Additional miscellaneous info to accompany the transaction, up to 4000 characters.
.IP "country" 4
.IX Item "country"
Customer's shipping country and also the default for b_country.
.IP "email" 4
.IX Item "email"
Customer's email address.  Required for address verification.
.IP "fname" 4
.IX Item "fname"
Customer's first name for shipping and also the default for b_fname.
.IP "item_desc" 4
.IX Item "item_desc"
An optional description of the product or services paid for. Up to 4000 characters.
Defaults to a summary of the shopping cart contents.
.IP "lname" 4
.IX Item "lname"
Customer's last name for shipping and also the default for b_lname.
.IP "mv_credit_card_cvv2" 4
.IX Item "mv_credit_card_cvv2"
Credit Card \s-1CVV2\s0 value. This is the three or four digit code on the back
of the customer's credit card. Optional, but often will get a lower rate
on the transaction.
.IP "mv_credit_card_exp_month" 4
.IX Item "mv_credit_card_exp_month"
The month of expiration as a two digit number.
.IP "mv_credit_card_exp_year" 4
.IX Item "mv_credit_card_exp_year"
The year of expiration as a two digit number.  This can accept a four digit
number in which case the first two digits will be discarded.
.IP "mv_credit_card_number" 4
.IX Item "mv_credit_card_number"
Credit Card Account Number \*(-- required for Credit Card transactions.
.IP "mv_order_number" 4
.IX Item "mv_order_number"
The number Interchange assigns to this order.  This gets stored as user data
in the transaction.  This will only come from processed values, not raw values
but it does default to the mv_order_number in session space.
.IP "phone_day" 4
.IX Item "phone_day"
Stored as the customer phone number for the transaction and required for address
verification.
.IP "state" 4
.IX Item "state"
Customer's shipping state and also the default for b_state.
.IP "zip" 4
.IX Item "zip"
Customer's shipping zip and also the default for b_zip.
.SH "TROUBLESHOOTING"
.IX Header "TROUBLESHOOTING"
In order to run a test transaction in NetBilling use the testing credit card
number set in the Setup/Account Config/Credit Cards section of the NetBilling
admin interface.
.PP
If nothing works:
.IP "\(bu" 4
Make sure you \*(L"Require\*(R"d the module in interchange.cfg:
.Sp
.Vb 1
\&    Require module Vend::Payment::NetBilling
.Ve
.IP "\(bu" 4
Make sure LWP::UserAgent LWP::Protocol::https and Digest::MD5 are installed
and working. You can test to see whether your Perl thinks they are:
.Sp
.Vb 1
\&    perl \-MLWP::UserAgent \-MLWP::Protocol::https \-MDigest::MD5 \-e \*(Aqprint "It works\en"\*(Aq
.Ve
.Sp
If it prints \*(L"It works.\*(R" and returns to the prompt you should be \s-1OK
\&\s0(presuming they are in working order otherwise).
.IP "\(bu" 4
Check the error logs, both catalog and global.
.IP "\(bu" 4
Make sure you set your payment parameters properly.
.IP "\(bu" 4
Try an order, then put this code in a page:
.Sp
.Vb 8
\&    <XMP>
\&    [calc]
\&        my $string = $Tag\->uneval( { ref => $Session\->{payment_result} });
\&        $string =~ s/{/{\en/;
\&        $string =~ s/,/,\en/g;
\&        return $string;
\&    [/calc]
\&    </XMP>
.Ve
.Sp
That should show what happened.
.IP "\(bu" 4
If all else fails, consultants are available to help
with integration for a fee.
.SH "BUGS"
.IX Header "BUGS"
There is actually nothing *in* Vend::Payment::NetBilling. It changes packages
to Vend::Payment and places things there.
.PP
You cannot randomly pick a transaction \s-1ID\s0 for NetBilling's Direct Mode.  The
\&\s-1ID\s0 must be assigned from NetBilling.  It should either be left blank or a
guaranteed unused \s-1ID\s0 can be retrieved from NetBilling prior to issuing the
transaction.  This module will overwrite any transaction \s-1ID\s0 supplied it with
the one assigned by NetBilling.
.SH "AUTHORS"
.IX Header "AUTHORS"
Mark Stosberg <mark@summersault.com>, based on original code by Mike Heins
<mike@perusion.com>.  Modified from the AuthorizeNet.pm module for NetBilling
and later rewritten by Peter Ajamian <peter@pajamian.dhs.org>.
.SH "CREDITS"
.IX Header "CREDITS"
.Vb 5
\&    Jeff Nappi <brage@cyberhighway.net>
\&    Paul Delys <paul@gi.alaska.edu>
\&    webmaster@nameastar.net
\&    Ray Desjardins <ray@dfwmicrotech.com>
\&    Nelson H. Ferrari <nferrari@ccsc.com>
.Ve
.SH "SEE ALSO"
.IX Header "SEE ALSO"
NetBilling Direct Mode 2.1 documentation is found at:
.PP
.Vb 1
\&    http://netbilling.com/direct/direct2.html
.Ve
