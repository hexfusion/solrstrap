.\" Automatically generated by Pod::Man 2.28 (Pod::Simple 3.29)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{
.    if \nF \{
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\" ========================================================================
.\"
.IX Title "Vend::CounterFile 3"
.TH Vend::CounterFile 3 "2016-12-23" "perl v5.22.2" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
Vend::CounterFile \- Persistent counter class
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
.Vb 2
\& use Vend::CounterFile;
\& $c = new Vend::CounterFile "COUNTER", "aa00";
\&
\& $id = $c\->inc;
\& open(F, ">F$id");
.Ve
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
(This module is modified from Gisle Aas File::CounterFile to use 
 Interchange's locking protocols \*(-- lack of fcntl locking was causing
 counter problems.)
.PP
This module implements a persistent counter class.  Each counter is
represented by a separate file in the file system.  File locking is
applied, so multiple processes might try to access the same counters
at the same time without risk of counter destruction.
.PP
You give the file name as the first parameter to the object
constructor (\f(CW\*(C`new\*(C'\fR).  The file is created if it does not exist.
.PP
If the file name does not start with \*(L"/\*(R" or \*(L".\*(R", then it is
interpreted as a file relative to \f(CW$Vend::CounterFile::DEFAULT_DIR\fR.
The default value for this variable is initialized from the
environment variable \f(CW\*(C`TMPDIR\*(C'\fR, or \fI/usr/tmp\fR is no environment
variable is defined.  You may want to assign a different value to this
variable before creating counters.
.PP
If you pass a second parameter to the constructor, that sets the
initial value for a new counter.  This parameter only takes effect
when the file is created (i.e. it does not exist before the call).
.PP
When you call the \f(CW\*(C`inc()\*(C'\fR method, you increment the counter value by
one. When you call \f(CW\*(C`dec()\*(C'\fR the counter value is decrementd.  In both
cases the new value is returned.  The \f(CW\*(C`dec()\*(C'\fR method only works for
numerical counters (digits only).
.PP
You can peek at the value of the counter (without incrementing it) by
using the \f(CW\*(C`value()\*(C'\fR method.
.PP
The counter can be locked and unlocked with the \f(CW\*(C`lock()\*(C'\fR and
\&\f(CW\*(C`unlock()\*(C'\fR methods.  Incrementing and value retrieval is faster when
the counter is locked, because we do not have to update the counter
file all the time.  You can query whether the counter is locked with
the \f(CW\*(C`locked()\*(C'\fR method.
.PP
There is also an operator overloading interface to the
Vend::CounterFile object.  This means that you might use the \f(CW\*(C`++\*(C'\fR
operator for incrementing the counter, \f(CW\*(C`\-\-\*(C'\fR operator for decrementing
and you can interpolate counters diretly into strings.
.SH "BUGS"
.IX Header "BUGS"
(This problem alleviated by this modified module)
.PP
It uses \fIflock\fR\|(2) to lock the counter file.  This does not work on all
systems.  Perhaps we should use the File::Lock module?
.SH "COPYRIGHT"
.IX Header "COPYRIGHT"
Copyright (c) 1995\-1998 Gisle Aas. All rights reserved.
Modifications made by and copyright (C) 2002 Red Hat, Inc.
and (c) 2002\-2007 Interchange Development Group
.PP
This library is free software; you can redistribute it and/or
modify it under the same terms as Perl itself.
.SH "AUTHOR"
.IX Header "AUTHOR"
Gisle Aas <aas@sn.no>
